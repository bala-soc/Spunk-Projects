# Analyzing DHCP Log Using Splunk SIEM

## Introduction
DHCP (Dynamic Host Configuration Protocol) log files contain valuable information about IP address assignments, lease durations, client requests, and server responses. Analyzing DHCP logs using Splunk SIEM enables network administrators to monitor IP address usage, detect anomalies, and troubleshoot network issues effectively.

## Project Overview
In this project, we will upload sample DHCP log files to Splunk SIEM and perform various analyses to gain insights into IP address assignment within the network.

## Prerequisites
Before starting the project, ensure the following:
- Splunk instance is installed and configured.
- DHCP log data sources are configured to forward logs to Splunk.

## Steps to Upload Sample DHCP Log Files to Splunk SIEM

### 1. Prepare Sample DHCP Log Files
- Obtain sample [DHCP log files](https://www.secrepo.com/maccdc2012/dhcp.log.gz) in a suitable format.
- Ensure the log files contain relevant DHCP events, including timestamps, IP address assignments, lease durations, client identifiers, etc.
- Save the sample log files in a directory accessible by the Splunk instance.

### 2. Upload Log Files to Splunk
- Log in to the Splunk web interface.
- Navigate to **Settings** > **Add Data**.

  <img width="863" height="771" alt="1" src="https://github.com/user-attachments/assets/5bed8d86-8b16-41a0-9985-4706eb22237d" />

- Select **Upload** as the data input method.

  <img width="1391" height="421" alt="2" src="https://github.com/user-attachments/assets/46049470-f366-4709-abdd-635a3e1e9648" />


### 3. Choose File
- Click on **Select File** and choose the sample DHCP log file you prepared earlier.
  
  <img width="1211" height="719" alt="3" src="https://github.com/user-attachments/assets/d91fd6a6-5e6a-4af4-a982-248097d81902" />


### 4. Set Source Type
- In the **Set Source Type** section, specify the source type for the uploaded log file.
- Choose the appropriate source type for DHCP logs (e.g., `dhcpd` or a custom source type if applicable).

  <img width="857" height="535" alt="4" src="https://github.com/user-attachments/assets/7e128c2e-2f11-44af-8245-5e6911686957" />

### 5. Review Settings
- Review other settings such as index, host, and sourcetype.
- Ensure the settings are configured correctly to match the sample DHCP log file.

  <img width="1306" height="870" alt="5" src="https://github.com/user-attachments/assets/752a5268-1c5d-4438-9c2a-8f6bc90b4695" />


### 6. Click Upload
- Once all settings are configured, click on the **Review** button.
- Review the settings one final time to ensure accuracy.
- Click **Submit** to upload the sample DHCP log file to Splunk.

  <img width="1302" height="538" alt="6" src="https://github.com/user-attachments/assets/062138d0-a401-45e6-8544-1cf85fd0b07d" />


### 7. Verify Upload
- After uploading, navigate to the search bar in the Splunk interface.

  <img width="1434" height="712" alt="7" src="https://github.com/user-attachments/assets/4ab35e00-caa8-462e-a32c-b90c97cd7ca4" />

- Run a search query to verify that the uploaded DHCP events are visible.

  <img width="1920" height="877" alt="8" src="https://github.com/user-attachments/assets/018fd845-740e-43c7-8c1c-bdbdbd609cf5" />


## Steps to Analyze DHCP Log Files in Splunk SIEM


### 1. 1. Search for DHCP Events
- Open Splunk interface and navigate to the search bar.
- Enter the following search query to retrieve DHCP events:
```
index=_* OR index=* sourcetype=dhcplog
```
<img width="1920" height="890" alt="9" src="https://github.com/user-attachments/assets/d9b83658-726f-468c-8826-bceba9372f2c" />


### 2. Extract Relevant Fields
- Identify key fields in DHCP logs such as timestamps, IP addresses, lease durations, client identifiers, etc.
- Use Splunk's field extraction capabilities or regular expressions to extract these fields for better analysis.
- Example extraction command
```
index=_* OR index=* sourcetype=dhcplog
| rex field=_raw "DHCP\w+\s+on\s+(?<assigned_ip>\d{1,3}(?:\.\d{1,3}){3})\s+to\s+(?<mac_address>(?:[0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2})\s+via\s+(?<interface>\w+).*?(?<lease_duration>\d+)?"
```
<img width="1920" height="880" alt="10" src="https://github.com/user-attachments/assets/4b9452f3-52ae-489d-ada3-161b341d0ebc" />


### 3. Analyze Email Traffic Patterns
- Determine the distribution of IP address assignments:
```
index=_* OR index=* sourcetype=dhcplog
| stats count by leased_ip
```
<img width="1920" height="405" alt="11" src="https://github.com/user-attachments/assets/2a87cde7-04b7-4b09-a5be-c3cbd18d67aa" />

- Identify top IP addresses leased by the DHCP server:
```
index=_* OR index=* sourcetype=dhcplog
| top limit=10 leased_ip
```
<img width="1920" height="411" alt="12" src="https://github.com/user-attachments/assets/9b9ed807-7c42-4c59-bf18-c21476797c06" />

### 4. Detect Anomalies
- Look for unusual patterns in IP address assignments:
```
index=_* OR index=* sourcetype=dhcplog
| timechart span=1h count 
```
<img width="1920" height="877" alt="13" src="https://github.com/user-attachments/assets/3d549aaf-75e9-4321-bb19-ae1be57a23af" />

- Analyze DHCP requests from unauthorized or unknown clients:
```
index=_* OR index=* sourcetype=dhcplog
| search NOT client_identifier="authorized_identifier"
```
<img width="1920" height="882" alt="14" src="https://github.com/user-attachments/assets/8c4a95b3-5b73-413d-8bc0-f53824d5f05d" />

### 5. Monitor IP Address Usage
- Monitor IP address usage over time:
```
index=_* OR index=* sourcetype=dhcplog
| timechart span=1h count by leased_ip
```
<img width="1920" height="880" alt="15" src="https://github.com/user-attachments/assets/849bdf23-3802-4141-967c-1e7305385710" />

- Identify IP addresses with multiple lease renewals or changes:
```
index=_* OR index=* sourcetype=dhcplog
| stats count by leased_ip, lease_renewal
| where count > 1 AND lease_renewal="true"
```
<img width="1920" height="430" alt="16" src="https://github.com/user-attachments/assets/28bb1f87-4a84-4d53-a313-377c7137f06e" />

- Analyze DHCP traffic patterns and deviations from normal behavior:
```
index=_* OR index=* sourcetype=dhcplog
| timechart span=1d count by leased_ip
```
<img width="1920" height="566" alt="17" src="https://github.com/user-attachments/assets/b3c1e462-0023-4f96-a7d8-22d9779ab8fb" />



## Conclusion
Analyzing DHCP log files using Splunk SIEM provides valuable insights into IP address assignment within a network. By monitoring DHCP events, detecting anomalies, and correlating with other logs, organizations can enhance their network management capabilities, troubleshoot issues, and improve overall network security.


