# Analyzing SSH Log Using Splunk SIEM

## Introduction
SSH (Secure Shell) log files contain valuable information about remote access to servers, including login attempts, commands executed, and session details. Analyzing SSH logs using Splunk SIEM enables security professionals to monitor access to critical systems, detect anomalies, and identify potential security threats.

## Project Overview
In this project, we will upload sample SSH log files to Splunk SIEM and perform various analyses to gain insights into SSH activity within the network.

## Prerequisites
Before starting the project, ensure the following:
- Splunk instance is installed and configured.
- SSH log data sources are configured to forward logs to Splunk.

## Steps to Upload Sample SSH Log Files to Splunk SIEM

### 1. Prepare Sample SSH Log Files
- Obtain sample [SSH log files](https://www.secrepo.com/maccdc2012/ssh.log.gz) in a suitable format (e.g., text files).
- Ensure the log files contain relevant SSH events, including timestamps, source IP addresses, usernames, actions (login, logout), etc.
- Save the sample log files in a directory accessible by the Splunk instance.

### 2. Upload Log Files to Splunk
- Log in to the Splunk web interface.
- Navigate to **Settings** > **Add Data**.

 <img width="863" height="771" alt="1" src="https://github.com/user-attachments/assets/487c124c-a43c-4bc3-b711-8b6f1735fbf1" />

- Select **Upload** as the data input method.
 <img width="1391" height="421" alt="2" src="https://github.com/user-attachments/assets/34bdaf5c-a2ab-47a7-8a79-cb1229ce6d9f" />

### 3. Choose File
- Click on **Select File** and choose the sample SSH log file you prepared earlier.
 <img width="1193" height="887" alt="3" src="https://github.com/user-attachments/assets/571efea0-9921-470b-8437-ea28b43d6ace" />

### 4. Set Source Type
- In the **Set Source Type** section, specify the source type for the uploaded log file.
- Choose the appropriate source type for SSH logs (e.g., `syslog` or a custom source type if applicable).
 <img width="909" height="550" alt="4" src="https://github.com/user-attachments/assets/c2dc90b1-8d92-4005-ac09-85aadeabaafb" />

### 5. Review Settings
- Review other settings such as index, host, and sourcetype.
- Ensure the settings are configured correctly to match the sample SSH log file.
 <img width="1320" height="878" alt="5" src="https://github.com/user-attachments/assets/82fd9fb5-7a4d-48bb-a970-0f961aaddd8d" />


### 6. Click Upload
- Once all settings are configured, click on the **Review** button.
- Review the settings one final time to ensure accuracy.
- Click **Submit** to upload the sample SSH log file to Splunk.
 <img width="1326" height="521" alt="6" src="https://github.com/user-attachments/assets/a7991bc7-f92c-456c-ad48-7f148f319b68" />

### 7. Verify Upload
- After uploading, navigate to the search bar in the Splunk interface.
 <img width="1422" height="696" alt="7" src="https://github.com/user-attachments/assets/dbb9a15d-f5ff-43cb-b87b-d58c407baca4" />

- Run a search query to verify that the uploaded SSH events are visible.
  
 <img width="1920" height="876" alt="8" src="https://github.com/user-attachments/assets/4b4c171d-6faf-43e7-b6f1-61222280017b" />


## Steps to Analyze SSH Log Files in Splunk SIEM


### 1. Search for SSH Events
- Open Splunk interface and navigate to the search bar.
- Enter the following search query to retrieve SSH events:
```
index=_* OR index=* sourcetype=sshlog
```
 <img width="1920" height="887" alt="9" src="https://github.com/user-attachments/assets/c742490e-7757-410a-b043-b905c4a02805" />

### 2. Extract Relevant Fields
- Identify key fields in SSH logs such as timestamps, source IP addresses, usernames, actions, etc.
- Use Splunk's field extraction capabilities or regular expressions to extract these fields for better analysis.
- Example extraction command:
```
index=_* OR index=* sourcetype=sshlog
| rex field=_raw "(?<ts_epoch>\d+\.\d+)\s+(?<uid>\S+)\s+(?<src_ip>\d+\.\d+\.\d+\.\d+)\s+(?<src_port>\d+)\s+(?<dst_ip>\d+\.\d+\.\d+\.\d+)\s+(?<dst_port>\d+)\s+(?<result>\S+)\s+(?<direction>\S+)\s+(?<client_version>\S+)\s+(?<server_version>\S+)"
| eval timestamp=strftime(ts_epoch, "%Y-%m-%d %H:%M:%S")
| stats 
    count(eval(result="failure")) AS failed_attempts,
    count(eval(result!="failure")) AS non_failures,
    dc(src_ip) AS unique_source_ips,
    dc(uid) AS unique_sessions
  BY direction, client_version, server_version
| sort - failed_attempts
```
 <img width="1920" height="893" alt="10" src="https://github.com/user-attachments/assets/e4b994cd-40d3-4d8f-90f6-41e62064177c" />

### 3. Analyze SSH Activity Patterns
- Determine the distribution of SSH commands executed:
```
index=_* OR index=* sourcetype=sshlog
| stats count by command
```
 <img width="1920" height="376" alt="11" src="https://github.com/user-attachments/assets/faae96ec-062c-436c-8182-b45ea6829943" />

- Identify top users or source IP addresses accessing the SSH server:
```
index=_* OR index=* sourcetype=sshlog
| top limit=10 user src_ip
```
 <img width="1920" height="383" alt="12" src="https://github.com/user-attachments/assets/d602318e-ad64-4f7f-b93d-a4825fc72fe5" />

- Analyze successful vs. failed SSH login attempts:
```
index=_* OR index=* sourcetype=sshlog
| stats count by action
```
 <img width="1920" height="395" alt="13" src="https://github.com/user-attachments/assets/c0b2516a-60d6-4905-ba8a-a1995ffcb661" />

### 4. Detect Anomalies
- Look for unusual patterns in SSH activity (e.g., sudden spikes in login attempts):
```
index=_* OR index=* sourcetype=sshlog
| timechart span=1h count
```
 <img width="1920" height="882" alt="14" src="https://github.com/user-attachments/assets/89551aa3-188b-4dd2-8142-091e23df618e" />

- Analyze failed login attempts:
```
index=_* OR index=* sourcetype=sshlog
| search action="failed"

```
 <img width="1920" height="356" alt="15" src="https://github.com/user-attachments/assets/d8890315-5600-4ee1-b2d2-5c6bc9067bb6" />

- Investigate SSH sessions from unusual or suspicious source IP addresses:
```
index=_* OR index=* sourcetype=sshlog
| rex "^(?<ts_epoch>\d+\.\d+)\t(?<uid>\S+)\t(?<src_ip>\S+)\t(?<src_port>\d+)\t(?<dst_ip>\S+)\t(?<dst_port>\d+)\t(?<result>\S+)"
| stats count by src_ip
| eventstats avg(count) AS avg_cnt stdev(count) AS sd_cnt
| where count < avg_cnt - (2 * sd_cnt) OR count < 3
| sort count
| rename count AS "Event Count"
```
 <img width="1920" height="883" alt="16" src="https://github.com/user-attachments/assets/6487f53b-003b-403d-b8c6-eb0c55f23114" />


### 5. Monitor User Behavior
- Identify users with multiple failed login attempts:
```
index=_* OR index=* sourcetype=sshlog
| rex "^(?<ts_epoch>\d+\.\d+)\t(?<uid>\S+)\t(?<src_ip>\S+)\t(?<src_port>\d+)\t(?<dst_ip>\S+)\t(?<dst_port>\d+)\t(?<result>\S+)"
| where result="failure"
| stats count AS failed_attempts by src_ip
| where failed_attempts > 3
| sort - failed_attempts
```
 <img width="1920" height="891" alt="17" src="https://github.com/user-attachments/assets/bda5fe92-dc13-4b9b-a656-73b07b63a40a" />

- Analyze user session durations:
```
index=_* OR index=* sourcetype=sshlog
| stats range(_time) as session_duration by session_id
| stats avg(session_duration) as avg_session_duration by user
```
 <img width="1920" height="413" alt="18" src="https://github.com/user-attachments/assets/fbe08e23-aafe-4ee2-8c12-dd4961d83cbd" />

## Conclusion
Analyzing SSH log files using Splunk SIEM provides valuable insights into remote access to servers within a network. By monitoring SSH events, detecting anomalies, and correlating with other logs, organizations can enhance their security posture and protect against unauthorized access and potential security threats.




