# Analyzing Tunnel Log Traffic Using Splunk SIEM

## Introduction
Tunnel log traffic from Zeek IDS (formerly known as Bro IDS) contains information about various tunneling protocols such as GRE, IPv4, IPv6, etc. Analyzing tunnel log traffic using Splunk SIEM enables security professionals to monitor tunneling activities, detect anomalies, and identify potential security threats.

## Project Overview
In this project, we will upload sample tunnel log traffic from Zeek IDS to Splunk SIEM and perform various analyses to gain insights into tunneling activities within the network.

## Prerequisites
Before starting the project, ensure the following:
- Splunk instance is installed and configured.
- Tunnel log data sources from Zeek IDS are configured to forward logs to Splunk.

## Steps to Upload Sample Tunnel Log Traffic from Zeek IDS to Splunk SIEM

### 1. Prepare Sample Tunnel Log Files
- Obtain sample [tunnel log files](https://www.secrepo.com/maccdc2012/tunnel.log.gz) from Zeek IDS in a suitable format (e.g., text files).
- Ensure the log files contain relevant tunneling events, including timestamps, source and destination IP addresses, tunneling protocols, etc.
- Save the sample log files in a directory accessible by the Splunk instance.

### 2. Upload Log Files to Splunk
- Log in to the Splunk web interface.
- Navigate to **Settings** > **Add Data**.
  
  <img width="863" height="771" alt="1" src="https://github.com/user-attachments/assets/a012e930-93ea-4eef-a976-f0a2ac30a462" />

- Select **Upload** as the data input method.
  
  <img width="1391" height="421" alt="2" src="https://github.com/user-attachments/assets/88d8f1c4-f4bb-45aa-b58d-9691597efe26" />


### 3. Choose File
- Click on **Select File** and choose the sample tunnel log file you prepared earlier.
  
  <img width="1240" height="719" alt="3" src="https://github.com/user-attachments/assets/f5481a2e-dfe4-41b4-9025-e4b70d581df5" />



### 4. Set Source Type
- In the **Set Source Type** section, specify the source type for the uploaded log file.
- Choose the appropriate source type for Zeek IDS tunnel logs (e.g., `bro` or a custom source type if applicable).
  
  <img width="795" height="526" alt="4" src="https://github.com/user-attachments/assets/0c49f178-a89d-4b0f-9e5c-8b8b4de20a2f" />


### 5. Review Settings
- Review other settings such as index, host, and sourcetype.
- Ensure the settings are configured correctly to match the sample tunnel log file.
  
  <img width="1338" height="873" alt="5" src="https://github.com/user-attachments/assets/f1e64e22-baef-416a-bbd5-9c943ab9c435" />



### 6. Click Upload
- Once all settings are configured, click on the **Review** button.
- Review the settings one final time to ensure accuracy.
- Click **Submit** to upload the sample tunnel log file to Splunk.
  
  <img width="1310" height="508" alt="6" src="https://github.com/user-attachments/assets/00e27c89-d26a-4431-95e3-c14d38e5d79f" />



### 7. Verify Upload
- After uploading, navigate to the search bar in the Splunk interface.
  
  <img width="1384" height="712" alt="7" src="https://github.com/user-attachments/assets/ae0fff76-eec8-4efe-ad13-a2ee242db90b" />


- Run a search query to verify that the uploaded tunnel events from Zeek IDS are visible.
  
  <img width="1920" height="880" alt="8" src="https://github.com/user-attachments/assets/867c9c52-a30a-4f81-8a3e-a08969fb85cc" />



## Steps to Analyze Tunnel Log Traffic in Splunk SIEM


### 1. Search for Tunnel Events
- Open Splunk interface and navigate to the search bar.
- Enter the following search query to retrieve tunnel events from Zeek IDS:
```
index=_* OR index=* sourcetype=tunnellog
```
  <img width="1920" height="884" alt="9" src="https://github.com/user-attachments/assets/25752dd6-9c89-4c64-926c-955eac1fdb99" />


### 2. Extract Relevant Fields
- Identify key fields in tunnel logs such as timestamps, source and destination IP addresses, tunneling protocols, etc.
- Use Splunk's field extraction capabilities or regular expressions to extract these fields for better analysis.
- Example extraction command:
```
index=_* OR index=* sourcetype=tunnellog
| rex field=_raw "^(?<ts>\d+\.\d+)\s+(?<uid>\S+)\s+(?<src_ip>\d{1,3}(?:\.\d{1,3}){3})\s+(?<src_port>\d+)\s+(?<dest_ip>\d{1,3}(?:\.\d{1,3}){3})\s+(?<dest_port>\d+)\s+(?<tunnel_protocol>Tunnel::\S+)\s+(?<action>Tunnel::\S+)"
```
  <img width="1920" height="870" alt="10" src="https://github.com/user-attachments/assets/2e4efa62-0d04-460b-8ba6-249609e267b0" />


### 3. Analyze Tunneling Protocols
- Determine the distribution of Tunnel commands executed:
```
index=_* OR index=*  sourcetype=tunnellog 
| stats count by tunnel_protocol
```
  <img width="1920" height="511" alt="11" src="https://github.com/user-attachments/assets/fac80317-b401-44da-8d23-5785cfc5f6c8" />

### 4. Detect Anomalies
- Look for unusual patterns or anomalies in GRE tunneling activity:
```
index=_* OR index=*  sourcetype=tunnellog 
| timechart count 
```
  <img width="1920" height="878" alt="12" src="https://github.com/user-attachments/assets/a8e96a30-fa67-434f-8785-9c109f1accf3" />


### 5. Monitor GRE Tunneling Activity
- Monitor GRE tunneling activity over time:
```
index=_* OR index=*  sourcetype=tunnellog 
| timechart span=1h count 
```
  <img width="1920" height="873" alt="13" src="https://github.com/user-attachments/assets/9c8a258c-7fcf-4815-ae76-f64496245635" />


## Conclusion
In conclusion, integrating Zeek IDS tunnel logs into Splunk SIEM provides security teams with the necessary visibility and tools to proactively monitor, detect, and respond to tunneling-related security incidents, ultimately enhancing overall cybersecurity posture and resilience against emerging threats.



